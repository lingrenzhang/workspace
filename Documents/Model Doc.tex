\documentclass{article}
\usepackage{amsmath, amssymb}
\begin{document}
\section{Match Score Calculation}
\subsection{Input Arguments}
\begin{itemize}
\item \textit{commute} - boolean indicating whether trip is one-time or commute.
\item \textit{roundtrip} - boolean indicating whether trip is one-way or roundtrip.
\item \textit{userType} - driver, rider (or both?).
\item \textit{dayOfWeek} - e.g. MonTueWedThuFri, indicating which days of week the trip happens, null if commute=false. (what's the best representation)
\item \textit{date} - trip date, null if commute=true.
\item \textit{originAdd} - address of the origin.(break into multiple fields?)
\item \textit{destinationAdd} - address of the destination.(break into multiple fields?)
\item \textit{detourFactor} - how much (at the maximum) user is willing to detour to pick someone up, default to 20\%.
\item \textit{forwardTime} - start time of the trip going from origin to destination.
\item \textit{forwardFlexibility} - flexibility of \textit{forward\_time}.  e.g. if \textit{forward\_time} is 9:00am and \textit{forward\_flexibility} is 30 minutes, then any start time between 8:30am-9:30am is acceptable.
\item \textit{backTime} - start time of trip going from destination to origin.  null if roundtrip=false.
\item \textit{backFlexibility} - similar to \textit{forward\_flexibility}.
\end{itemize}
Use subscript 1 and 2 to distinguish between 2 users.

\subsection{Type Match Score}
Type match score=1 if and only if
\begin{equation*}
\mbox{commute}_1 == \mbox{commute} \ \&\& \ \mbox{roundtrip}_1==\mbox {roundtrip}_2 \ \&\&\ (\mbox{userType}_1 == \mbox{driver} || \mbox{userType}_2 == \mbox{driver}).
\end{equation*}
Otherwise type match score=0.

\subsection{Destination Match Score}
For simplicity we use the following notations:
\begin{itemize}
\item $A_1$, $B_1$ as origin and destination of user 1, $A_2$, $B_2$ as origin and destination of user 2.
\item $d(A, B)$ as travel distance from A to B, $t(A,B)$ as time required to travel from A to B.  Both should be obtained from Google Map API.
\end{itemize}
Assume that user 1 is driver and user 2 is rider, calculate the total distance travelled by driver (including picking up) as $d(A_1, A_2) + d(A_2,B_2) + d(B_2, B_1)$, see how much it increased relative to distance travelled without the rider $d(A_1, B_1)$.  Then we compare the increased percentage to driver's \textit{detourFactor}, and calculate a match score:
\begin{equation*}
\max\{0, 1- [\left(d(A_1, A_2) + d(A_2,B_2) + d(B_2, B_1)\right)/d(A_1, B_1)-1]/\mbox{detourFactor}_1 \}.
\end{equation*}

If both users are drivers, we can calculate a destination match scores for each of:
\begin{itemize}
\item user 1 picks up user 2.
\item user 2 picks up user 1.
\end{itemize}
Choose the better score and inform the users accordingly.

\subsection{Time Match Score}
For simplicity we use the following notations:
\begin{itemize}
\item $t_1$, $tol_1$ as forwardTime and forwardFlexibility for user 1.
\item $t_2$, $tol_2$ as forwardTime and forwardFlexibility for user 2.
\item $s_1$, $s_2$ indicates how satisfied user 1/2 is about the schedule.
\end{itemize}
Time $t$ is picked for the trip, notice that $s_1$, $s_2$ are both functions of t.  Define:
\begin{eqnarray*}
s_1(t) &=& \max\{ 0, 1-|t_1-t|/tol_1\}\\
s_2(t) &=& \max\{ 0, 1-|t_2-t|/tol_2\}
\end{eqnarray*}
Both drivers can opt-out of the ride share, therefore it is reasonable to choose $\min\{ s_1(t), s_2(t)\}$ as the time match score.  Therefore goal is to find $t$ that maximizes the time match score.  The optimization problem below yields both optimal trip time $t$ and the best possible time match score.
\begin{equation*}
\max_t \min\{ s_1(t), s_2(t)\}
\end{equation*}

For roundtrips, do the same thing for the trip back and multiply the scores.  (For example, if time only match for the trip from origin to destination but not the trip back, then score should be 0 because you can't drop off the rider at his/her destination without any means for him/her to come back)

\subsection{Match Score}
Each of the three sections above gives a score between [0,1], the aggregated score can be calculated as the product of the three.
\begin{equation*}
\mbox{Match Score} = \mbox{Type Match Score} \times \mbox{Destination Match Score} \times \mbox{Time Match Score}
\end{equation*}

\subsection{Return}
Return results with match score above a certain threshold (0.8?), from high to low.

\section{Pricing Scheme}
\subsection{Observation}
A lot of cheap bids posted on zimride which does not make sense.  Enforce a lower limit to the amount rider pays.

\section{Details to add}
\begin{itemize}
\item Should be able to match roundtrip with one-way, although in reality most are round trips.
\item When both parties are drivers there are two ways of matching.
\item Take into account time required for driver to arrive at rider's place, which is not negligible.
\item Find closed-form solution for Section time match score.
\end{itemize}
\end{document}