<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable = no" />
<title>搭便车 | 寻找临时拼车</title>
<link rel="stylesheet" href="css/foundation.css" />
<link rel="stylesheet" href="foundation-icons/foundation-icons.css" />
<link rel="stylesheet" href="css/main.css" />
<script src="js/vendor/modernizr.js"></script>
</head>
<body>
	<div class="off-canvas-wrap" data-offcanvas>
		<div class="inner-wrap">
			<div class="row">
				<nav class="top-bar hide-for-small" data-offcanvas>
					<ul class="title-area">
						<li class="name"><h1>
								<a href="#"><img
									style="height: 36px; margin-top: -8px; margin-left: 2px;"
									src="icon/har_logo_32_w.png" alt="Logo">搭便车</a>
							</h1></li>
					</ul>
					<section class="top-bar-section">
						<ul class="right">
							<li class="divider"></li>
							<li class=""><a href="javascript:alert('开发中')" class="">用户中心</a></li>
							<li class="divider"></li>
							<li><a href="javascript:alert('开发中')" class="">拼车管理</a></li>
							<li class="divider"></li>
							<li class="active"><a href="searchtransientride.html">寻找临时拼车</a></li>
						</ul>
					</section>
				</nav>
			</div>
			<nav class="tab-bar show-for-small">
				<section class="left-small">
					<a class="left-off-canvas-toggle menu-icon"><span></span></a>
				</section>
				<section class="middle tab-bar-section">
					<h1 class="title">拼车信息</h1>
				</section>
			</nav>
			<aside class="left-off-canvas-menu">
				<ul class="off-canvas-list">
					<li><label class="first">搭便车</label></li>
					<li><a href="javascript:alert('开发中')" class=""><i class="fi-calendar"></i>&nbsp;拼车管理</a></li>
					<li><a href="searchtransientride.html" class="active"><i
							class="fi-magnifying-glass"></i>&nbsp;寻找临时拼车</a></li>
				</ul>
				<hr>
				<ul class="off-canvas-list">
					<li><label class="first"><i class="fi-home"></i>&nbsp;用户中心</label></li>
					<li><a href="javascript:alert('开发中')" class=""><i class="fi-comments"></i>&nbsp;我的行程</a></li>
					<li><a href="javascript:alert('开发中')" class=""><i class="fi-mail"></i>&nbsp;我的消息</a></li>
					<li><a href="javascript:alert('开发中')" class=""><i class="fi-clock"></i>&nbsp;历史记录</a></li>
					<li><a href="javascript:alert('开发中')" class=""><i class="fi-torso"></i>&nbsp;个人信息</a></li>
				</ul>
			</aside>
			<a class="exit-off-canvas" href="#"></a>

			<section role="main" class="scroll-container" id="main">
				<div class="row hide" id="ride_info">
					<br>
					<div class="row panel">
						<div class="small-3 columns header text-center">
							<div class="th">
								<img id="owner_pic" src="../UserProfile/default.jpg" />
							</div>
							<div class="row text-center">
								<i class="fi-torso"></i>
								<div id="owner_name"></div>
							</div>
						</div>
						<div class="small-9 columns text-center">
							<div class="row text-center">
								<a id="owner_call" type="button" href="#"
									class="button small round expand"><i class="fi-telephone"></i>电话联系</a>
							</div>
							<div class="row text-center">
								<a id="owner_sms" type="button" href="#"
									class="button small round expand"><i class="fi-mail"></i>短信联系</a>
							</div>
						</div>
					</div>
					<div class="row panel">
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-calendar"></i>
							</div>
							<div class="small-11 columns">
								<div id="date"></div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-clock"></i>
							</div>
							<div class="small-11 columns">
								<div id="time"></div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-home"></i>
							</div>
							<div class="small-11 columns">
								<div id="origAddr"></div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-target"></i>
							</div>
							<div class="small-11 columns">
								<div id="destAddr"></div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-info"></i>
							</div>
							<div class="small-11 columns">
								<div id="userType"></div>
							</div>
						</div>
						<br>
						<div class="row" id="price_label">
							<div class="small-1 columns header text-center">
								<i class="fi-yen"></i>
							</div>
							<div class="small-11 columns">
								<span id="price"></span>元
							</div>
							<br>
						</div>
						<div class="row">
							<div class="small-1 columns header text-center">
								<i class="fi-torsos-all"></i>
							</div>
							<div class="small-11 columns">
								剩余<span id="seat"></span>座
							</div>
						</div>

					</div>
				</div>
				<div class="text-center hide" id="failed">
					<div data-alert class="alert-box round alert ">找不到该拼车信息</div>
				</div>
				<div class="row text-center" id="msg_box"></div>
				<div class="text-center">
					<a id="return" type="button" href="javascript:history.go(-1)"
						class="button small round">返回</a>
					<div id="del_btn" class="hide" style="display: inline">
						<a id="del" data-reveal-id="delModal" type="button" href="#"
							class="button alert small round">删除</a>
					</div>
					<div id="delModal" class="reveal-modal" data-reveal>
						<h2>确定删除此临时拼车？</h2>
						<a href="javascript:delTransientTide()"
							class="button alert small round">删除</a> <a
							href="javascript:$('a.close-reveal-modal').trigger('click')"
							class="button small round">取消</a> <a class="close-reveal-modal">&#215;</a>
					</div>
				</div>
				<hr>
				<br> <br> <br>
			</section>
		</div>
	</div>

	<script src="js/vendor/jquery.js"></script>
	<script src="js/foundation.min.js"></script>
	<script>
		var uid = null;
		var trId = location.hash.replace('#', '');
		function checkLogin() {
			$.get('../api/mLoginChecker', function(data) {
				var result = JSON.parse(data);
				if (!(result.status && result.status == "successful")) {
					window.location.assign(result.redirect);
				} else {
					uid = result.uid;
					getTransientTide();
				}
			});
		}
		checkLogin();
		function getTransientTide() {
			$.get("../api/mGetTransientRide?trId=" + trId,
					function(data) {
						var result = JSON.parse(data);
						if (result.status && result.status == "successful") {
							$('#ride_info').removeClass('hide');
							$('#owner_name')[0].innerHTML = result.owner.name;
							$('#owner_pic')[0].src = '../UserProfile/'
									+ result.owner.pic;
							$('#owner_call')[0].href = 'tel:'
									+ result.owner.cellPhone;
							$('#owner_sms')[0].href = 'sms://'
									+ result.owner.cellPhone;
							if (result.owner.uid == uid) {
								$('#del_btn').removeClass('hide');
							}

							$('#date')[0].innerHTML = result.date;
							$('#time')[0].innerHTML = result.time;
							$('#origAddr')[0].innerHTML = result.origLoc.addr;
							$('#destAddr')[0].innerHTML = result.destLoc.addr;
							var userType = "自驾";
							$('#price')[0].innerHTML = result.price;
							if (result.userType == true) {
								userType = "TAXI";
								$('#price_label').addClass('hide');
							}
							$('#userType')[0].innerHTML = userType;
							$('#seat')[0].innerHTML = result.totalSeats;
						} else {
							$('#ride_info').addClass('hide');
							$('#failed').removeClass('hide');
						}
					});

		}
		function delTransientTide() {
			$('a.close-reveal-modal').trigger('click');
			if ($("#del").hasClass("disabled")) {
				return;
			}
			$("#del").addClass("disabled");
			$
					.post(
							"../api/mDelTransientRide",
							{
								trId : trId
							},
							function(data) {
								var result = JSON.parse(data);
								if (result.status
										&& result.status == "successful") {
									alert("成功删除");
									window.location.assign(result.redirect);
								} else {
									$("#del").removeClass("disabled");
									$("#msg_box")
											.prepend(
													'<div data-alert class="alert-box round alert ">'
															+ result.reason
															+ '<a href="#" class="close">&times;</a></div>');
									$(document).foundation();
									if (result.redirect
											&& result.redirect != "") {
										window.location.assign(result.redirect);
									}
								}
							});

		}

		$(document).foundation();
	</script>
	<div id="baidu_tongji" style="display: none">
		<script type="text/javascript">
			var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://"
					: " http://");
			document
					.write(unescape("%3Cscript src='"
							+ _bdhmProtocol
							+ "hm.baidu.com/h.js%3F04d65d39238bfa4301b173d21ddcfeb7' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>
</body>
</html>
